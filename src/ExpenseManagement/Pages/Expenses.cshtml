@page
@model ExpenseManagement.Pages.ExpensesModel
@{
    ViewData["Title"] = "Expenses";
}

<div class="expenses-page">
    <h1>Expenses</h1>
    
    <div class="filters">
        <form method="get" class="filter-form">
            <label for="status">Filter by Status:</label>
            <select name="status" id="status" onchange="this.form.submit()">
                <option value="">All</option>
                <option value="Draft" selected="@(Model.StatusFilter == "Draft")">Draft</option>
                <option value="Submitted" selected="@(Model.StatusFilter == "Submitted")">Submitted</option>
                <option value="Approved" selected="@(Model.StatusFilter == "Approved")">Approved</option>
                <option value="Rejected" selected="@(Model.StatusFilter == "Rejected")">Rejected</option>
            </select>
        </form>
        <a href="/AddExpense" class="btn btn-primary">Add New Expense</a>
    </div>

    @if (Model.Expenses.Any())
    {
        <table class="expense-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Submitted By</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var expense in Model.Expenses)
                {
                    <tr>
                        <td>@expense.ExpenseDate.ToString("dd/MM/yyyy")</td>
                        <td>@expense.CategoryName</td>
                        <td>@expense.Description</td>
                        <td class="amount">Â£@expense.Amount.ToString("N2")</td>
                        <td><span class="status-badge @expense.StatusName.ToLower()">@expense.StatusName</span></td>
                        <td>@expense.UserName</td>
                        <td class="actions">
                            @if (expense.StatusName == "Draft")
                            {
                                <form method="post" asp-page-handler="Submit" asp-route-id="@expense.ExpenseId" style="display:inline;">
                                    <button type="submit" class="btn btn-small">Submit</button>
                                </form>
                            }
                            <form method="post" asp-page-handler="Delete" asp-route-id="@expense.ExpenseId" style="display:inline;">
                                <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="no-data">No expenses found.</p>
    }
</div>
