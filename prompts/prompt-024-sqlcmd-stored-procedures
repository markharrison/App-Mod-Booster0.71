The application should access all data through stored procedures rather than embedding SQL queries in the code. This provides better security (prevents SQL injection), performance (query plans are cached), and maintainability (database changes don't require code redeployment).

Create a stored-procedures.sql file at the repository root containing all the stored procedures the application needs.

Key requirements:

- Use CREATE OR ALTER PROCEDURE syntax so the script can run multiple times without errors
- Every stored procedure called by the application code must exist in this file
- The application code should never construct dynamic SQL or access tables directly
- Column aliases in stored procedures must exactly match the property names expected by the C# code

Column naming alignment is critical:

If a stored procedure returns a calculated column like `CAST(e.AmountMinor / 100.0 AS DECIMAL(10,2)) AS AmountDecimal`, the C# code must use `reader.GetOrdinal("AmountDecimal")` to read it - not a different name like `Amount`. A mismatch causes "Unable to cast object" or "column not found" runtime errors.

Similarly, if the stored procedure returns `reviewer.UserName AS ReviewedByName`, the C# code must use `GetOrdinal("ReviewedByName")` not `GetOrdinal("ReviewerName")`.

Quick reference for this application's column mappings:

| Stored Procedure Column | C# Model Property | Notes |
|------------------------|-------------------|-------|
| AmountMinor | AmountMinor | INT in database |
| AmountDecimal | Amount | Calculated DECIMAL(10,2) |
| ReviewedByName | ReviewerName | Aliased from reviewer.UserName |

The infrastructure deployment script (deploy-infra/deploy.ps1) automatically imports these stored procedures using sqlcmd with Entra ID authentication.

For manual execution, use sqlcmd with the --authentication-method=ActiveDirectoryDefault argument.

Don't use Python scripts for executing SQL. The sqlcmd tool handles GO batch separators natively and is the recommended approach for all database script execution.


