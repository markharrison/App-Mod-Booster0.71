create a python file called run-sql with the contents below, 
changing the server and database variables at the top to those created earlier in the process.
If you were not asked to create them then leave them as is.

bear in mind making it work on Mac as well:

Not cross platform:
sed -i "s/MANAGED-IDENTITY-NAME/$MANAGED_IDENTITY_NAME/g" script.sql

Works cross platform (ie for Mac)
sed -i.bak "s/MANAGED-IDENTITY-NAME/$MANAGED_IDENTITY_NAME/g" script.sql && rm -f script.sql.bak

also update the deploy.sh file to add this:

# Install required Python packages if not already installed
pip3 install --quiet pyodbc azure-identity

# Run the Python script
python3 run-sql.py

also create a file called script.sql and put the following changing MANAGED-IDENTITY to the user assigned managed identity you created earlier 

# Drop and recreate the managed identity user with correct SID
sql = """
IF EXISTS (SELECT * FROM sys.database_principals WHERE name = 'MANAGED-IDENTITY')
BEGIN
    DROP USER [MANAGED-IDENTITY];
END

CREATE USER [MANAGED-IDENTITY] FROM EXTERNAL PROVIDER;
ALTER ROLE db_datareader ADD MEMBER [MANAGED-IDENTITY];
ALTER ROLE db_datawriter ADD MEMBER [MANAGED-IDENTITY];
"""

Python file contents:

#!/usr/bin/env python3
"""
Execute SQL script on Azure SQL Database using Azure Active Directory authentication
"""
import pyodbc
import struct
from azure.identity import AzureCliCredential

# Database connection settings
SERVER = "example.database.windows.net"
DATABASE = "database_name"
SQL_SCRIPT_FILE = "script.sql"

def get_access_token():
    """Get Azure AD access token using Azure CLI credentials"""
    credential = AzureCliCredential()
    token = credential.get_token("https://database.windows.net/.default")
    return token.token

def execute_sql_script(server, database, script_file):
    """Execute SQL script using Azure AD token authentication"""
    
    # Get access token
    print("Getting Azure AD access token...")
    access_token = get_access_token()
    
    # Convert token to bytes for ODBC
    token_bytes = access_token.encode("utf-16-le")
    token_struct = struct.pack(f"<I{len(token_bytes)}s", len(token_bytes), token_bytes)
    
    # Connection string with token authentication
    connection_string = (
        f"Driver={{ODBC Driver 18 for SQL Server}};"
        f"Server={server};"
        f"Database={database};"
        f"Encrypt=yes;"
        f"TrustServerCertificate=no;"
    )
    
    # Specify the token as connection attribute
    SQL_COPT_SS_ACCESS_TOKEN = 1256
    
    print(f"Connecting to {server}/{database}...")
    conn = pyodbc.connect(connection_string, attrs_before={SQL_COPT_SS_ACCESS_TOKEN: token_struct})
    
    try:
        # Read SQL script
        print(f"Reading SQL script from {script_file}...")
        with open(script_file, 'r') as f:
            sql_script = f.read()
        
        # Split script into individual statements (by GO or semicolon)
        statements = []
        current_statement = []
        
        for line in sql_script.split('\n'):
            line = line.strip()
            if line.upper() == 'GO':
                if current_statement:
                    statements.append('\n'.join(current_statement))
                    current_statement = []
            elif line:
                current_statement.append(line)
        
        if current_statement:
            statements.append('\n'.join(current_statement))
        
        # Execute each statement
        cursor = conn.cursor()
        for i, statement in enumerate(statements, 1):
            if statement.strip():
                print(f"Executing statement {i}/{len(statements)}...")
                try:
                    cursor.execute(statement)
                    conn.commit()
                    print(f"  ✓ Statement {i} executed successfully")
                except Exception as e:
                    print(f"  ✗ Error executing statement {i}: {e}")
                    raise
        
        print("\n✓ All SQL statements executed successfully!")
        
    finally:
        conn.close()

if __name__ == "__main__":
    try:
        execute_sql_script(SERVER, DATABASE, SQL_SCRIPT_FILE)
    except Exception as e:
        print(f"\n✗ Error: {e}")
        exit(1)

